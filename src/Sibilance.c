
/*
 **************************************************************************
 *
 * $Workfile: $
 *   $Author: $
 *  $Modtime: $
 * $Revision: $
 *
 **************************************************************************
 * Version history
 *
 * $History: $
 * 
 **************************************************************************
 */

//************************************************************************
//
// MODULES USED
//
//************************************************************************

#include <p33FJ256GP506.h>
#include <dsp.h>

#include "clipper.h"


//************************************************************************
//
// DEFINITIONS AND MACROS
//
//************************************************************************

#define SIBIL_SIZE 101


//************************************************************************
//
// LOCAL MEMORY ALLOCATIONS
//
//************************************************************************


static fractional DelayBufQ[SIBIL_SIZE] _YDATA(2);
static fractional DelayBufI[SIBIL_SIZE] _YDATA(2);

static FIRStruct FIRFilterQ;
static FIRStruct FIRFilterI;

static unsigned int ipage, qpage;
static fractional* ioffset, qoffset;


const fractional SIBILI_3300[SIBIL_SIZE] =
{0x0000, 0x0000, 0x0001, 0x0000, 0xFFFC, 0xFFFF, 0x0007, 0x0005, 0xFFF7, 0xFFF5, 
0x0007, 0x0011, 0xFFFE, 0xFFEF, 0xFFFC, 0x000A, 0x0003, 0x0002, 0x000D, 0xFFF6, 
0xFFCF, 0xFFFE, 0x0064, 0x0036, 0xFF6F, 0xFF64, 0x0099, 0x012E, 0xFFAB, 0xFE33, 
0xFFAC, 0x0242, 0x0164, 0xFDB1, 0xFD4A, 0x01BA, 0x0402, 0xFF92, 0xFB1A, 0xFE87, 
0x0505, 0x03A9, 0xFBD8, 0xFA57, 0x0251, 0x06FA, 0x003A, 0xF8C6, 0xFD04, 0x0645, 
0x0560, 0xFBBD, 0xF91A, 0x019E, 0x0740, 0x011B, 0xF991, 0xFCA7, 0x04B7, 0x04B8, 
0xFD71, 0xFAED, 0x0076, 0x0487, 0x012A, 0xFC9D, 0xFDE5, 0x0209, 0x025A, 0xFF30, 
0xFDEF, 0xFFF2, 0x017E, 0x0083, 0xFF1F, 0xFF64, 0x0063, 0x007D, 0xFFEA, 0xFFB6, 
0xFFF8, 0x001D, 0x0008, 0xFFFE, 0x0004, 0xFFFB, 0xFFF1, 0x0002, 0x0012, 0x0005, 
0xFFF2, 0xFFF7, 0x0008, 0x0008, 0xFFFD, 0xFFFB, 0x0000, 0x0002, 0x0000, 0x0000, 
0x0000, };

const fractional SIBILQ_3300[SIBIL_SIZE] =
{0x0000, 0x0000, 0x0000, 0x0002, 0x0000, 0xFFFB, 0xFFFD, 0x0008, 0x0008, 0xFFF7, 
0xFFF2, 0x0005, 0x0012, 0x0002, 0xFFF1, 0xFFFB, 0x0004, 0xFFFE, 0x0008, 0x001D, 
0xFFF8, 0xFFB6, 0xFFEA, 0x007D, 0x0063, 0xFF64, 0xFF1F, 0x0083, 0x017E, 0xFFF2, 
0xFDEF, 0xFF30, 0x025A, 0x0209, 0xFDE5, 0xFC9D, 0x012A, 0x0487, 0x0076, 0xFAED, 
0xFD71, 0x04B8, 0x04B7, 0xFCA7, 0xF991, 0x011B, 0x0740, 0x019E, 0xF91A, 0xFBBD, 
0x0560, 0x0645, 0xFD04, 0xF8C6, 0x003A, 0x06FA, 0x0251, 0xFA57, 0xFBD8, 0x03A9, 
0x0505, 0xFE87, 0xFB1A, 0xFF92, 0x0402, 0x01BA, 0xFD4A, 0xFDB1, 0x0164, 0x0242, 
0xFFAC, 0xFE33, 0xFFAB, 0x012E, 0x0099, 0xFF64, 0xFF6F, 0x0036, 0x0064, 0xFFFE, 
0xFFCF, 0xFFF6, 0x000D, 0x0002, 0x0003, 0x000A, 0xFFFC, 0xFFEF, 0xFFFE, 0x0011, 
0x0007, 0xFFF5, 0xFFF7, 0x0005, 0x0007, 0xFFFF, 0xFFFC, 0x0000, 0x0001, 0x0000, 
0x0000, };

const fractional SIBILI_3400[SIBIL_SIZE] =
{0x0000, 0x0000, 0xFFFF, 0x0001, 0x0003, 0xFFFF, 0xFFF9, 0xFFFF, 0x000C, 0x0005, 
0xFFF2, 0xFFF6, 0x000D, 0x000D, 0xFFF7, 0xFFF6, 0x0002, 0xFFFD, 0x0001, 0x001E, 
0x0008, 0xFFB9, 0xFFD7, 0x0075, 0x006C, 0xFF64, 0xFF29, 0x00A7, 0x0168, 0xFF7F, 
0xFDEF, 0x0013, 0x02B8, 0x00AC, 0xFCC5, 0xFE46, 0x0374, 0x0302, 0xFCBF, 0xFBA1, 
0x028F, 0x059E, 0xFEA1, 0xF974, 0xFFC9, 0x06FA, 0x0206, 0xF934, 0xFC2D, 0x05FE, 
0x0560, 0xFB5A, 0xF988, 0x02F1, 0x06F7, 0xFEE5, 0xF92B, 0xFF62, 0x0623, 0x0206, 
0xFAFB, 0xFD08, 0x03B1, 0x0369, 0xFDA8, 0xFC9D, 0x012A, 0x0300, 0xFFBE, 0xFD99, 
0xFFAC, 0x01BA, 0x009C, 0xFEE5, 0xFF59, 0x009C, 0x008B, 0xFFBB, 0xFFA2, 0x0015, 
0x0031, 0xFFFF, 0xFFF1, 0xFFFF, 0xFFFB, 0xFFFB, 0x000D, 0x000C, 0xFFF4, 0xFFF2, 
0x0007, 0x000D, 0xFFFD, 0xFFF6, 0x0000, 0x0005, 0x0001, 0xFFFE, 0x0000, 0x0000, 
0x0000, };

const fractional SIBILQ_3400[SIBIL_SIZE] =
{0x0000, 0x0000, 0x0000, 0xFFFE, 0x0001, 0x0005, 0x0000, 0xFFF6, 0xFFFD, 0x000D, 
0x0007, 0xFFF2, 0xFFF4, 0x000C, 0x000D, 0xFFFB, 0xFFFB, 0xFFFF, 0xFFF1, 0xFFFF, 
0x0031, 0x0015, 0xFFA2, 0xFFBB, 0x008B, 0x009C, 0xFF59, 0xFEE5, 0x009C, 0x01BA, 
0xFFAC, 0xFD99, 0xFFBE, 0x0300, 0x012A, 0xFC9D, 0xFDA8, 0x0369, 0x03B1, 0xFD08, 
0xFAFB, 0x0206, 0x0623, 0xFF62, 0xF92B, 0xFEE5, 0x06F7, 0x02F1, 0xF988, 0xFB5A, 
0x0560, 0x05FE, 0xFC2D, 0xF934, 0x0206, 0x06FA, 0xFFC9, 0xF974, 0xFEA1, 0x059E, 
0x028F, 0xFBA1, 0xFCBF, 0x0302, 0x0374, 0xFE46, 0xFCC5, 0x00AC, 0x02B8, 0x0013, 
0xFDEF, 0xFF7F, 0x0168, 0x00A7, 0xFF29, 0xFF64, 0x006C, 0x0075, 0xFFD7, 0xFFB9, 
0x0008, 0x001E, 0x0001, 0xFFFD, 0x0002, 0xFFF6, 0xFFF7, 0x000D, 0x000D, 0xFFF6, 
0xFFF2, 0x0005, 0x000C, 0xFFFF, 0xFFF9, 0xFFFF, 0x0003, 0x0001, 0xFFFF, 0x0000, 
0x0000, };

const fractional SIBILI_3450[SIBIL_SIZE] =
{0x0000, 0x0000, 0xFFFF, 0x0001, 0x0003, 0xFFFF, 0xFFF9, 0xFFFF, 0x000C, 0x0005, 
0xFFF2, 0xFFF6, 0x000D, 0x000D, 0xFFF7, 0xFFF6, 0x0002, 0xFFFD, 0x0001, 0x001E, 
0x0008, 0xFFB9, 0xFFD7, 0x0075, 0x006C, 0xFF64, 0xFF29, 0x00A7, 0x0168, 0xFF7F, 
0xFDEF, 0x0013, 0x02B8, 0x00AC, 0xFCC5, 0xFE46, 0x0374, 0x0302, 0xFCBF, 0xFBA1, 
0x028F, 0x059E, 0xFEA1, 0xF974, 0xFFC9, 0x06FA, 0x0206, 0xF934, 0xFC2D, 0x05FE, 
0x0560, 0xFB5A, 0xF988, 0x02F1, 0x06F7, 0xFEE5, 0xF92B, 0xFF62, 0x0623, 0x0206, 
0xFAFB, 0xFD08, 0x03B1, 0x0369, 0xFDA8, 0xFC9D, 0x012A, 0x0300, 0xFFBE, 0xFD99, 
0xFFAC, 0x01BA, 0x009C, 0xFEE5, 0xFF59, 0x009C, 0x008B, 0xFFBB, 0xFFA2, 0x0015, 
0x0031, 0xFFFF, 0xFFF1, 0xFFFF, 0xFFFB, 0xFFFB, 0x000D, 0x000C, 0xFFF4, 0xFFF2, 
0x0007, 0x000D, 0xFFFD, 0xFFF6, 0x0000, 0x0005, 0x0001, 0xFFFE, 0x0000, 0x0000, 
0x0000, };

const fractional SIBILQ_3450[SIBIL_SIZE] =
{0x0000, 0x0000, 0x0000, 0xFFFE, 0x0001, 0x0005, 0x0000, 0xFFF6, 0xFFFD, 0x000D, 
0x0007, 0xFFF2, 0xFFF4, 0x000C, 0x000D, 0xFFFB, 0xFFFB, 0xFFFF, 0xFFF1, 0xFFFF, 
0x0031, 0x0015, 0xFFA2, 0xFFBB, 0x008B, 0x009C, 0xFF59, 0xFEE5, 0x009C, 0x01BA, 
0xFFAC, 0xFD99, 0xFFBE, 0x0300, 0x012A, 0xFC9D, 0xFDA8, 0x0369, 0x03B1, 0xFD08, 
0xFAFB, 0x0206, 0x0623, 0xFF62, 0xF92B, 0xFEE5, 0x06F7, 0x02F1, 0xF988, 0xFB5A, 
0x0560, 0x05FE, 0xFC2D, 0xF934, 0x0206, 0x06FA, 0xFFC9, 0xF974, 0xFEA1, 0x059E, 
0x028F, 0xFBA1, 0xFCBF, 0x0302, 0x0374, 0xFE46, 0xFCC5, 0x00AC, 0x02B8, 0x0013, 
0xFDEF, 0xFF7F, 0x0168, 0x00A7, 0xFF29, 0xFF64, 0x006C, 0x0075, 0xFFD7, 0xFFB9, 
0x0008, 0x001E, 0x0001, 0xFFFD, 0x0002, 0xFFF6, 0xFFF7, 0x000D, 0x000D, 0xFFF6, 
0xFFF2, 0x0005, 0x000C, 0xFFFF, 0xFFF9, 0xFFFF, 0x0003, 0x0001, 0xFFFF, 0x0000, 
0x0000, };

const fractional SIBILI_3600[SIBIL_SIZE] =
{0x0000, 0x0000, 0x0001, 0xFFFF, 0xFFFD, 0x0002, 0x0007, 0xFFFD, 0xFFF4, 0x0003, 
0x0010, 0xFFFE, 0xFFEE, 0xFFFF, 0x000F, 0x0002, 0xFFFB, 0x0001, 0xFFF2, 0xFFF4, 
0x002C, 0x0025, 0xFFAB, 0xFFAD, 0x0084, 0x009C, 0xFF4C, 0xFEFC, 0x00DC, 0x018D, 
0xFF0D, 0xFDCC, 0x00ED, 0x02F4, 0xFF40, 0xFC3F, 0x0065, 0x048B, 0x0028, 0xFABE, 
0xFF1E, 0x05D4, 0x01C1, 0xF9D0, 0xFD49, 0x064B, 0x03B1, 0xF9E0, 0xFB65, 0x05B0, 
0x0560, 0xFAFC, 0xFA10, 0x042A, 0x063E, 0xFCCB, 0xF9BA, 0x023A, 0x0609, 0xFEB3, 
0xFA6F, 0x007F, 0x04EB, 0x0025, 0xFBD8, 0xFF68, 0x035A, 0x00DC, 0xFD6E, 0xFF0C, 
0x01DD, 0x00EB, 0xFEBC, 0xFF36, 0x00CC, 0x009C, 0xFF8C, 0xFF94, 0x0039, 0x003F, 
0xFFE9, 0xFFE4, 0x0005, 0x0003, 0x0001, 0x000B, 0xFFFF, 0xFFEF, 0xFFFF, 0x0011, 
0x0003, 0xFFF2, 0xFFFD, 0x0009, 0x0003, 0xFFFB, 0xFFFE, 0x0002, 0x0001, 0x0000, 
0x0000, };

const fractional SIBILQ_3600[SIBIL_SIZE] =
{0x0000, 0x0000, 0x0001, 0x0002, 0xFFFE, 0xFFFB, 0x0003, 0x0009, 0xFFFD, 0xFFF2, 
0x0003, 0x0011, 0xFFFF, 0xFFEF, 0xFFFF, 0x000B, 0x0001, 0x0003, 0x0005, 0xFFE4, 
0xFFE9, 0x003F, 0x0039, 0xFF94, 0xFF8C, 0x009C, 0x00CC, 0xFF36, 0xFEBC, 0x00EB, 
0x01DD, 0xFF0C, 0xFD6E, 0x00DC, 0x035A, 0xFF68, 0xFBD8, 0x0025, 0x04EB, 0x007F, 
0xFA6F, 0xFEB3, 0x0609, 0x023A, 0xF9BA, 0xFCCB, 0x063E, 0x042A, 0xFA10, 0xFAFC, 
0x0560, 0x05B0, 0xFB65, 0xF9E0, 0x03B1, 0x064B, 0xFD49, 0xF9D0, 0x01C1, 0x05D4, 
0xFF1E, 0xFABE, 0x0028, 0x048B, 0x0065, 0xFC3F, 0xFF40, 0x02F4, 0x00ED, 0xFDCC, 
0xFF0D, 0x018D, 0x00DC, 0xFEFC, 0xFF4C, 0x009C, 0x0084, 0xFFAD, 0xFFAB, 0x0025, 
0x002C, 0xFFF4, 0xFFF2, 0x0001, 0xFFFB, 0x0002, 0x000F, 0xFFFF, 0xFFEE, 0xFFFE, 
0x0010, 0x0003, 0xFFF4, 0xFFFD, 0x0007, 0x0002, 0xFFFD, 0xFFFF, 0x0001, 0x0000, 
0x0000, };

//************************************************************************
//
// LOCAL FUNCTION PROTOTYPES
//
//************************************************************************


//************************************************************************
//
// EXPORTED FUNCTIONS
//
//************************************************************************



void InitSibil(int freq)
{
   switch (freq)
   {
      case 0:
			asm("mov #psvpage(_SIBILQ_3300),w0\nmov w0,_qpage");
			asm("mov #psvoffset(_SIBILQ_3300),w0\nmov w0,_qoffset");
 			asm("mov #psvpage(_SIBILI_3300),w0\nmov w0,_ipage");
			asm("mov #psvoffset(_SIBILI_3300),w0\nmov w0,_ioffset");
			break;
      case 1:
			asm("mov #psvpage(_SIBILQ_3400),w0\nmov w0,_qpage");
			asm("mov #psvoffset(_SIBILQ_3400),w0\nmov w0,_qoffset");
 			asm("mov #psvpage(_SIBILI_3400),w0\nmov w0,_ipage");
			asm("mov #psvoffset(_SIBILI_3400),w0\nmov w0,_ioffset");
			break;
      case 2:
			asm("mov #psvpage(_SIBILQ_3450),w0\nmov w0,_qpage");
			asm("mov #psvoffset(_SIBILQ_3450),w0\nmov w0,_qoffset");
 			asm("mov #psvpage(_SIBILI_3450),w0\nmov w0,_ipage");
			asm("mov #psvoffset(_SIBILI_3450),w0\nmov w0,_ioffset");
			break;
      case 3:
			asm("mov #psvpage(_SIBILQ_3600),w0\nmov w0,_qpage");
			asm("mov #psvoffset(_SIBILQ_3600),w0\nmov w0,_qoffset");
 			asm("mov #psvpage(_SIBILI_3600),w0\nmov w0,_ipage");
			asm("mov #psvoffset(_SIBILI_3600),w0\nmov w0,_ioffset");
			break;
      default:
			asm("mov #psvpage(_SIBILQ_3300),w0\nmov w0,_qpage");
			asm("mov #psvoffset(_SIBILQ_3300),w0\nmov w0,_qoffset");
 			asm("mov #psvpage(_SIBILI_3300),w0\nmov w0,_ipage");
			asm("mov #psvoffset(_SIBILI_3300),w0\nmov w0,_ioffset");
			break;
   }
   
   FIRStructInit(&FIRFilterQ, SIBIL_SIZE, qoffset, qpage, DelayBufQ);
   FIRDelayInit(&FIRFilterQ);

   FIRStructInit(&FIRFilterI, SIBIL_SIZE, ioffset, ipage, DelayBufI);
   FIRDelayInit(&FIRFilterI);
   
}// InitSibil


void ProcSibil(fractional* pIn, fractional* IOut, fractional* QOut)
{

	FIR(FRAME_SIZE, IOut, pIn, &FIRFilterI);	//create I data
	FIR(FRAME_SIZE, QOut, pIn, &FIRFilterQ);	//create Q data
	
}// ProcSibil




